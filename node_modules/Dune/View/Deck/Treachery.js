var Loader = require("Dune/Loader");
var canvasContainer = require("Dune/CanvasContainer");
var shuffleArray = require("Dune/shuffle");
var eventChain = require("Dune/EventChain");
var DeckViewDecorator = require("Dune/View/Deck/Base");

module.exports = new TreacheryDeckView();

function TreacheryDeckView() 
{
  var loader = new Loader();

  var treacheryDeckImages = new Array(
    "baliset", "chaumas", "chaumurky", "chrysknife", "cheapheroine", 
    "ellacadrug", "familyatomics", "gomjabbar", "hajr", 
    "harvester", "jubbacloak", "kulon", "lalala", "lasgun", 
    "maulapistol", "sliptip", "stunner", "thumper", "tleilaxughola", 
    "triptogamont", "weathercontrol"
  );

  var duplicateCards = new Array(
    Array.apply(null, new Array(4)).map(function() { return "shield" }),
    Array.apply(null, new Array(4)).map(function() { return "snooper" }),
    Array.apply(null, new Array(2)).map(function() { return "cheaphero" }),
    Array.apply(null, new Array(2)).map(function() { return "karama" })
  );

  for (var i = 0; i < duplicateCards.length; i++) {
    var duplicateCardArray = duplicateCards[i];
    treacheryDeckImages = treacheryDeckImages.concat(duplicateCardArray);
  }

  for (var i = 0; i < treacheryDeckImages.length; i++) {
    var treacheryDeckImage = treacheryDeckImages[i];
    var treacheryImgUrl = "/img/treachery/" + treacheryDeckImage + ".png";
    treacheryDeckImages[i] = loader.loadImage(treacheryImgUrl);
  }

  loader.onload = function() {
    shuffleArray(treacheryDeckImages);
  }

  var args = {"getCardImage": getNewTreacheryImage, "deckImages": [], 
    "deckPathUrl": "img/treachery/"}; 
  DeckViewDecorator(this, args);

  function getNewTreacheryImage() {
    var treacheryImg = treacheryDeckImages.shift();
    return treacheryImg;
  }
}
