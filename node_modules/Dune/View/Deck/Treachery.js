module.exports = TreacheryDeckView;
//var controller = require("../../Controller");
var mapView = require("Dune/View/Map");
var Loader = require("Dune/Loader");
var canvasContainer = require("Dune/CanvasContainer");

function TreacheryDeckView() 
{
  //var canvasContainer = controller.canvasContainer;
  var canvas;
  var context;

  //var loader = new controller.Loader();
  var loader = new Loader();

  var cardScaleWidth = 333,
      cardScaleHeight = 483;

  var treacheryImgUrl = "/img/treachery/chrysknife.png";
  var treacheryImg = loader.loadImage(treacheryImgUrl);

  var that = this;

  this.dealCard = function() 
  {
    canvas = canvasContainer.layer("notification");
    context = canvas.getContext("2d");
    //canvasContainer.moveLayerToTop(canvas);


    //var mapDimensions = controller.views.map.circle;
    var mapDimensions = mapView.circle;

    var xPos = mapDimensions.centerX - cardScaleWidth/2;
    var yPos = mapDimensions.centerY - cardScaleHeight/2;

    canvas.redraw = function() { 
      context.clearRect(0, 0, canvas.width, canvas.height)
    }

    treacheryImg.canvas = canvas;
    treacheryImg.xPos = canvas.width;
    treacheryImg.yPos = yPos;
    treacheryImg.speed = 0.02;
    treacheryImg.width = cardScaleWidth;
    treacheryImg.height = cardScaleHeight;

    var xCenterScreen = mapDimensions.centerX - cardScaleWidth/2;
    var yCenterScreen = mapDimensions.centerY - cardScaleHeight/2;

    treacheryImg.moveToCoord([xCenterScreen, yCenterScreen]);

    treacheryImg.onHalt = function() {
      setTimeout(function() { 

	var xPos = 0 - cardScaleWidth;
	var yPos = yCenterScreen;

	treacheryImg.moveToCoord([xPos, yPos]);

	treacheryImg.onHalt = function() {

	  canvasContainer.deleteLayer(canvas);

	  if (that.onDealCard) {
	    that.onDealCard(this);
	    delete that.onDealCard;
	  }
	}


      }, 1000);

    }

    return treacheryImg;
  }
}
