module.exports = AtreidesView;

var FactionDecorator = require("./Base");
var controller = require("../../Controller");
var gameView = require("Dune/View/Game");
var eventChain = require("Dune/EventChain");
var canvasContainer = require("Dune/CanvasContainer");
var bonusDeckView = require("Dune/View/Deck/Bonus.js");

function AtreidesView() {


  var images = {
    "troop": "atreides.png",
    "bid": "atreides.png",
    "leaderPath": "/img/leaders/atreides/",
    "leaders": [ "dr._yueh.png", "duncan_idaho.png", "gurney_halleck.png", 
      "lady_jessica.png", "thufir_hawat.png" ],
    "emblem": "atreides-53x53.png"
  }

  var args = {
    "faction": gameView.players['Atreides'],
    "images": images
  };

  FactionDecorator(this, args);

  var playerScreen = args.playerScreen;

  var obj = this;

  this.shipInitialTroops = function() 
  { 
    var startingTerritory = "arrakeen";
    //var startingTerritory = "carthag";

    for (var i = 0; i < 9; i++) {
      eventChain.add(function () {
	playerScreen.shipTroops(startingTerritory);
      });
    }

    playerScreen.shipTroops(startingTerritory);

    eventChain.add(function() { 
      var notificationCanvas = canvasContainer.layer("notification");
      canvasContainer.deleteLayer(notificationCanvas);
      eventChain.next();
    });

    eventChain.add([
      function() { 
      	var card = bonusDeckView.dealCard("ornithopters") 
	obj.takeCard(card);
      },
      function() { playerScreen.addBonusCard(obj.dealtCard()) },
      function() { 
      	var card = bonusDeckView.dealCard("harvesters") 
	obj.takeCard(card);
      },
      function() { playerScreen.addBonusCard(obj.dealtCard()) },
      function() { 
      	var card = bonusDeckView.dealCard("carryalls") 
	obj.takeCard(card);
      },
      function() { playerScreen.addBonusCard(obj.dealtCard()) }

    ]);

  }

}
