module.exports = HarkonnenView;

var FactionDecorator = require("./Base");
var gameView = require("Dune/View/Game");
var eventChain = require("Dune/EventChain");
var TraitorSelect = require("../TraitorSelect.js");
var canvasContainer = require("Dune/CanvasContainer");
var bonusDeckView = require("Dune/View/Deck/Bonus.js");

function HarkonnenView() {


  var traitorImages;
  var traitorSelect = new TraitorSelect();

  traitorSelect.selectTraitor = function(canvas, element) {
    traitorImages = canvas.elements;

    traitorSelect.selectTraitorImage(traitorImages.shift());
  }

  var priv = {};

  var images = {
    "troop": "harkonnen.png",
    "leaderPath": "/img/leaders/harkonnen/",
    "leaders": [ "beast_rabban.png", "captain_iakin_nefud.png", "feyd_rautha.png", 
      "piter_de_vries.png", "umman_kudu.png" ],
    "emblem": "harkonnen-53x53.png"
  };

  FactionDecorator(this, {
    "faction": gameView.players['Harkonnen'],
    "private": priv,
    "traitorSelect": traitorSelect,
    "images": images
  });

  var playerScreen = priv.playerScreen;

  var obj = this;

  this.setupEventChain = function() {
    eventChain.add([
      function() { obj.promptUserSelectTraitor() },
      function() { playerScreen.addTraitorCard(obj.dealtCard()) },
      function() { traitorSelect.selectTraitorImage(traitorImages.shift()) },
      function() { playerScreen.addTraitorCard(obj.dealtCard()) },
      function() { traitorSelect.selectTraitorImage(traitorImages.shift()) },
      function() { playerScreen.addTraitorCard(obj.dealtCard()) },
      function() { traitorSelect.selectTraitorImage(traitorImages.shift()) },
      function() { playerScreen.addTraitorCard(obj.dealtCard()) },
      function() { obj.drawTreacheryCard() },
      function() { playerScreen.addTreacheryCard(obj.dealtCard()) },
      function() { obj.drawTreacheryCard() },
      function() { playerScreen.addTreacheryCard(obj.dealtCard()) },
      function() { obj.shipInitialTroops() }
    ]);
  }

  this.shipInitialTroops = function() 
  { 
    for (var i = 0; i < 9; i++) {
      eventChain.add(function () {
	playerScreen.shipTroops("polarSink");
      });
    }


    playerScreen.shipTroops("polarSink");

    eventChain.add(function() { 
      var notificationCanvas = canvasContainer.layer("notification");
      canvasContainer.deleteLayer(notificationCanvas);
      eventChain.next();
    });

    eventChain.add([
      function() { 
      	var card = bonusDeckView.dealCard("ornithopters") 
	obj.takeCard(card);
      },
      function() { playerScreen.addBonusCard(obj.dealtCard()) },
      function() { 
      	var card = bonusDeckView.dealCard("harvesters") 
	obj.takeCard(card);
      },
      function() { playerScreen.addBonusCard(obj.dealtCard()) },
      function() { 
      	var card = bonusDeckView.dealCard("carryalls") 
	obj.takeCard(card);
      },
      function() { playerScreen.addBonusCard(obj.dealtCard()) }

    ]);

  }

}
