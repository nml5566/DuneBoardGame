module.exports = BidMenuViewDecorator;

var canvasContainer = require("Dune/CanvasContainer");
var mapView = require("Dune/View/Map");
var Caption = require("Dune/View/Caption");

function BidMenuViewDecorator(obj, args)
{

  var faction = args.faction;

  var notificationCanvas = canvasContainer.layer("notification");
  var notificationCtx = notificationCanvas.getContext("2d");

  obj.showBidMenu = function() 
  {

    var circle = mapView.circle;
    circle.angle = mapView.convertSectorNumberToMapAngle(faction.seat);

    var offset = (-0.35) * circle.radius;
    var coordinates = 
      mapView.calculateSectorEdgeFromMapAngle([offset,offset]);

    var bidMenuRadius = 220;
    var bidMenuSide = Math.sqrt(2) * bidMenuRadius/2;
    var bidMenu = {
      "side": bidMenuRadius,
      "x": coordinates[0] - bidMenuSide/2,
      "y": coordinates[1] - bidMenuSide/2
    }

   notificationCtx.lineWidth = 5;
    //notificationCtx.strokeStyle = "black";
    //notificationCtx.strokeRect(
      //bidMenu.x, bidMenu.y,
      //bidMenuSide, bidMenuSide
    /*);*/

    var bidPortraitHeight = 90;
    var bidPortrait = {
      "img": args.images.bid.portrait,
      "x": bidMenu.x,
      //"y": bidMenu.y + (bidMenuSide - bidPortraitHeight)/2,
      "y": bidMenu.y,
      "width": bidMenuSide,
      "height": bidPortraitHeight
    }

/*    notificationCtx.strokeStyle = "black";*/
    //notificationCtx.strokeRect(
	    //bidPortrait.x, bidPortrait.y,
	    //bidPortrait.width, bidPortrait.height
    /*);*/

    notificationCtx.drawImage(bidPortrait.img, bidPortrait.x, bidPortrait.y,
      bidPortrait.width, bidPortrait.height);

    var caption = new Caption();
    caption.setFontSize(17);
    caption.setText("PASS");
    caption.setCoords({
      "x": bidPortrait.x,
      "y": bidPortrait.y - caption.height()
    });
    caption.draw();

    caption.setText("BID");
    caption.setCoords({
      "x": bidPortrait.x + bidPortrait.width - caption.width(),
      "y": bidPortrait.y - caption.height()
    });
    caption.draw();

    var spiceBidRadius = 
      (bidPortrait.y + (bidMenuSide - bidPortraitHeight)/2 - bidMenu.y);
    var spiceBid = {
      "img": args.images.bid.spice,
      "x": bidMenu.x + bidPortrait.width/2 - spiceBidRadius,
      "y": bidMenu.y + bidPortrait.height,
      "radius": spiceBidRadius
    }
/*    notificationCtx.strokeStyle = "green";*/
    //notificationCtx.beginPath();
    //notificationCtx.arc(
            //spiceBid.x, spiceBid.y, spiceBid.radius, 0, 2 * Math.PI
    //);
    //notificationCtx.stroke();
    /*notificationCtx.closePath();*/

    notificationCtx.drawImage(spiceBid.img, 
	spiceBid.x, spiceBid.y,
    	spiceBid.radius * 2, spiceBid.radius * 2);

   var raiseSpiceButton = {
      "img": args.images.bid.raise,
      "x": spiceBid.x + spiceBid.radius * 2,
      "y": spiceBid.y,
      "height": spiceBid.radius * 2,
      "width": bidMenuSide/3
    }

    notificationCtx.drawImage(raiseSpiceButton.img, 
	raiseSpiceButton.x, raiseSpiceButton.y,
	raiseSpiceButton.width, raiseSpiceButton.height);

    showLowerSpiceBidButton(spiceBid, bidMenuSide, bidMenu);
  }

  function showRaiseSpiceBidButton()
  {
  }

  function showLowerSpiceBidButton(spiceBid, bidMenuSide, bidMenu)
  {
    var lowerSpiceButton = {
      "img": args.images.bid.lower,
      //"x": spiceBid.x - spiceBid.radius * 2,
      "x": spiceBid.x - spiceBid.radius * 1.5,
      //"x": bidMenu.x,
      "y": spiceBid.y,
      "height": spiceBid.radius * 2,
      "width": bidMenuSide/3
    }

    notificationCtx.drawImage(lowerSpiceButton.img, 
	lowerSpiceButton.x, lowerSpiceButton.y,
	lowerSpiceButton.width, lowerSpiceButton.height);
  
    return;

    notificationCtx.beginPath();
    notificationCtx.moveTo(lowerSpiceButton.x, lowerSpiceButton.y);
    notificationCtx.lineTo(
      lowerSpiceButton.x, 
      lowerSpiceButton.y + lowerSpiceButton.height
    );
    notificationCtx.lineTo(
      lowerSpiceButton.x - lowerSpiceButton.width, 
      lowerSpiceButton.y + lowerSpiceButton.height/2
    );
    notificationCtx.lineTo( lowerSpiceButton.x, lowerSpiceButton.y );

    notificationCtx.stroke();
    notificationCtx.closePath();

  }

}
