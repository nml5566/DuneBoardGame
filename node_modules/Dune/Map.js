module.exports = ArrakisMap;

function ArrakisMap() {
  var cache = {};

  this.getTerritory = function(territoryName) {

    if (! cache[territoryName]) {
      var territory = loadTerritoryModule(territoryName);
      
      trapMapObjectInTerritoryFunctionScope(this, territory);

      cache[territoryName] = territory;
    }

    return cache[territoryName];
  }

  function trapMapObjectInTerritoryFunctionScope(arrakisMap, territory) {
  /* TO give territory map cache access without publicly exposing it */
    var oldSetNeighbors = territory.setNeighbors;
    territory.setNeighbors = function() {
      oldSetNeighbors(arrakisMap);
    }
  }

  function loadTerritoryModule(territoryName) {
    var Territory = require("./Map/" + territoryName);
    return new Territory();
    
  }

  return this;
}


