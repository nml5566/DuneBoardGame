module.exports = testSpiceDeck;

var assert = require("assert");
var modulino = require("modulino");
var spiceDeck = require("Dune/Deck/Spice");

var territoriesSeen = { };

modulino(testSpiceDeck, module);


function testSpiceDeck() {
  testSpiceDeckCount();
  testSpiceBlowTerritoriesRepeatAfterDeckReshuffle();
}

function testSpiceDeckCount() 
{
  var wormsSeen = [];
  var drawCount = 0;

  for (var i = 1; i <= 21; i++) 
  {
    var spiceCard = spiceDeck.dealCard();
    if (spiceCard.spice) 
    {
      assert(! territoriesSeen[spiceCard.territory], 
	spiceCard.territory + " card was seen more than once"
      );
      territoriesSeen[spiceCard.territory] = true;
    }
    else { wormsSeen.push(spiceCard) }
  }

  assert(Object.keys(territoriesSeen).length == 15, 
      "There aren't 15 spice blow cards in the spice deck");
  assert(wormsSeen.length == 6, "There aren't 6 worms in the spice deck");
}

function testSpiceBlowTerritoriesRepeatAfterDeckReshuffle() 
{
  while(true) 
  {
    var spiceCard = spiceDeck.dealCard();

    if (spiceCard.spice) 
    {
      assert(territoriesSeen[spiceCard.territory], 
      	"All territories should have been seen after drawing 21 cards"
      );
      break;
    }
  }

}

