var shuffleArray = require("Dune/shuffle");
module.exports = new SpiceDeck();

function SpiceDeck() 
{

  var cards = makeDeck();
  var drawnTerritoriesCount = 0;

  function makeDeck() 
  {
    var spiceCards = makeSpiceCards();
    var wormCards = makeWormCards();
    var cards = spiceCards.concat(wormCards);
    shuffleArray(cards);
    return cards;
  }

  function makeWormCards() 
  {
    var wormCards = Array.apply(null, new Array(6)).map(
	function() { return { "isWorm": true } });
    return wormCards;
  }
  
  function makeSpiceCards() 
  {
    var spiceBlows = new Array(
      ["cielagoSouth", 12], ["southMesa", 10], ["redChasm", 8], 
      ["sihayaRidge", 6], ["oldGap", 6], ["brokenLand", 8], 
      ["rockOutcroppings", 6], ["funeralPlain", 6], ["theGreatFlat", 10], 
      ["habbanyaErg", 8], ["habbanyaRidgeFlat", 10], ["cielagoNorth", 8],
      ["theMinorErg", 8], ["haggaBasin", 6], ["windPassNorth", 6]
    );

    var spiceCards = [];

    for (var i = 0; i < spiceBlows.length; i++) 
    {
      var spiceBlow = spiceBlows[i];
      var card = { "territory": spiceBlow[0], "spice": spiceBlow[1] };
      spiceCards.push(card);
    }

    return spiceCards;
  }


  this.dealCard = function() 
  {
    if (drawnTerritoriesCount == 2) {
      drawnTerritoriesCount = 0;
      return false;
    }

    if (! cards.length) cards = makeDeck();
    var dealtCard = cards.shift();

    if (dealtCard.spice)
      drawnTerritoriesCount++;

    return dealtCard;
  }

}
